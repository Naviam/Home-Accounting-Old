(function(a){jQuery.fn.html5_upload=function(b){var c=["onStart","onStartOne","onProgress","onFinishOne","onFinish","onError"],b=jQuery.extend({onStart:function(){return true},onStartOne:function(){return true},onProgress:function(){},onFinishOne:function(){},onFinish:function(){},onError:function(){},autostart:true,autoclear:true,stopOnFirstError:false,STATUSES:{STARTED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",PROGRESS:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",LOADED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",FINISHED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd"},setName:function(){},setStatus:function(){},setProgress:function(){},genName:function(c,a,b){return c+"("+(a+1)+" \ufffd\ufffd "+b+")"},genStatus:function(a,c){return c?b.STATUSES.FINISHED:a==0?b.STATUSES.STARTED:a==1?b.STATUSES.LOADED:b.STATUSES.PROGRESS},genProgress:function(a,b){return a/b}},b);function d(){var g=this.files,e=g.length,c=a(this);if(!c.triggerHandler("html5_upload.onStart",[e]))return false;this.disabled=true;var h=0,d=this.html5_upload.xhr;this.html5_upload.continue_after_abort=true;function f(a){if(a==e){c.trigger("html5_upload.onFinish",[e]);b.setStatus(b.genStatus(1,true));c.attr("disabled",false);b.autoclear&&c.val("");return}var h=g[a];if(!c.triggerHandler("html5_upload.onStartOne",[h.fileName,a,e]))return f(a+1);b.setStatus(b.genStatus(0));b.setName(b.genName(h.fileName,a,e));b.setProgress(b.genProgress(0,h.fileSize));d.upload.onprogress=function(d){c.trigger("html5_upload.onProgress",[d.loaded/d.total,h.fileName,a,e]);b.setStatus(b.genStatus(d.loaded/d.total));b.setProgress(b.genProgress(d.loaded,d.total))};d.onload=function(){c.trigger("html5_upload.onFinishOne",[d.responseText,h.fileName,a,e]);b.setStatus(b.genStatus(1,true));b.setProgress(b.genProgress(h.fileSize,h.fileSize));f(a+1)};d.onabort=function(){if(c[0].html5_upload.continue_after_abort)f(a+1);else{c.attr("disabled",false);b.autoclear&&c.val("")}};d.onerror=function(d){c.trigger("html5_upload.onError",[h.fileName,d]);!b.stopOnFirstError&&f(a+1)};d.onreadystatechange=function(){if(d.readyState==4)d.status==500&&parseSiteError(d)};d.open("post",typeof b.url=="function"?b.url():b.url,true);var i=new FormData;i.append("fileToUpload",h);d.send(i)}f(0);return true}return this.each(function(){this.html5_upload={xhr:new XMLHttpRequest,continue_after_abort:true};b.autostart&&a(this).bind("change",d);for(event in c)b[c[event]]&&a(this).bind("html5_upload."+c[event],b[c[event]]);a(this).bind("html5_upload.start",d).bind("html5_upload.cancelOne",function(){this.html5_upload.xhr.abort()}).bind("html5_upload.cancelAll",function(){this.html5_upload.continue_after_abort=false;this.html5_upload.xhr.abort()}).bind("html5_upload.destroy",function(){this.html5_upload.continue_after_abort=false;this.xhr.abort();delete this.html5_upload;a(this).unbind("html5_upload.*").unbind("change",d)})})}})(jQuery)