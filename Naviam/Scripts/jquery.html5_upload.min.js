(function(a){jQuery.fn.html5_upload=function(b){var c=["onStart","onStartOne","onProgress","onFinishOne","onFinish","onError"],b=jQuery.extend({onStart:function(){return true},onStartOne:function(){return true},onProgress:function(){},onFinishOne:function(){},onFinish:function(){},onError:function(){},autostart:true,autoclear:true,stopOnFirstError:false,STATUSES:{STARTED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",PROGRESS:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",LOADED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd",FINISHED:"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd"},setName:function(){},setStatus:function(){},setProgress:function(){},genName:function(c,a,b){return c+"("+(a+1)+" \ufffd\ufffd "+b+")"},genStatus:function(a,c){return c?b.STATUSES.FINISHED:a==0?b.STATUSES.STARTED:a==1?b.STATUSES.LOADED:b.STATUSES.PROGRESS},genProgress:function(a,b){return a/b}},b);function d(){var g=this.files,e=g.length,d=a(this);if(!d.triggerHandler("html5_upload.onStart",[e]))return false;this.disabled=true;var h=0,c=this.html5_upload.xhr;this.html5_upload.continue_after_abort=true;function f(h){if(h==e){d.trigger("html5_upload.onFinish",[e]);b.setStatus(b.genStatus(1,true));d.attr("disabled",false);b.autoclear&&d.val("");return}var a=g[h];if(!d.triggerHandler("html5_upload.onStartOne",[a.fileName,h,e]))return f(h+1);b.setStatus(b.genStatus(0));b.setName(b.genName(a.fileName,h,e));b.setProgress(b.genProgress(0,a.fileSize));c.upload.onprogress=function(c){d.trigger("html5_upload.onProgress",[c.loaded/c.total,a.fileName,h,e]);b.setStatus(b.genStatus(c.loaded/c.total));b.setProgress(b.genProgress(c.loaded,c.total))};c.onload=function(){d.trigger("html5_upload.onFinishOne",[c.responseText,a.fileName,h,e]);b.setStatus(b.genStatus(1,true));b.setProgress(b.genProgress(a.fileSize,a.fileSize));f(h+1)};c.onabort=function(){if(d[0].html5_upload.continue_after_abort)f(h+1);else{d.attr("disabled",false);b.autoclear&&d.val("")}};c.onerror=function(c){d.trigger("html5_upload.onError",[a.fileName,c]);!b.stopOnFirstError&&f(h+1)};c.open("post",typeof b.url=="function"?b.url():b.url,true);c.setRequestHeader("Cache-Control","no-cache");c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("X-File-Name",a.fileName);c.setRequestHeader("X-File-Size",a.fileSize);c.setRequestHeader("Content-Type","multipart/form-data");c.send(a)}f(0);return true}return this.each(function(){this.html5_upload={xhr:new XMLHttpRequest,continue_after_abort:true};b.autostart&&a(this).bind("change",d);for(event in c)b[c[event]]&&a(this).bind("html5_upload."+c[event],b[c[event]]);a(this).bind("html5_upload.start",d).bind("html5_upload.cancelOne",function(){this.html5_upload.xhr.abort()}).bind("html5_upload.cancelAll",function(){this.html5_upload.continue_after_abort=false;this.html5_upload.xhr.abort()}).bind("html5_upload.destroy",function(){this.html5_upload.continue_after_abort=false;this.xhr.abort();delete this.html5_upload;a(this).unbind("html5_upload.*").unbind("change",d)})})}})(jQuery)