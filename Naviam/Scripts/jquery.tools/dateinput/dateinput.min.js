(function(a){a.tools=a.tools||{version:"@VERSION"};var f=[],e,k=[75,76,38,39,74,72,40,37],d={};e=a.tools.dateinput={conf:{format:"mm/dd/yy",selectors:false,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:undefined,max:undefined,trigger:false,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},localize:function(c,b){a.each(b,function(a,c){b[a]=c.split(",")});d[c]=b}};e.localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"});e.localize("ru",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"});function j(b,a){return 32-(new Date(b,a,32)).getDate()}function h(a,b){a=""+a;b=b||2;while(a.length<b)a="0"+a;return a}var n=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,m=a("<a/>");function i(a,j,b){var g=a.getDate(),f=a.getDay(),c=a.getMonth(),i=a.getFullYear(),e={d:g,dd:h(g),ddd:d[b].shortDays[f],dddd:d[b].days[f],m:c+1,mm:h(c+1),mmm:d[b].shortMonths[c],mmmm:d[b].months[c],yy:String(i).slice(2),yyyy:i},k=j.replace(n,function(a){return a in e?e[a]:a.slice(1,a.length-1)});return m.html(k).html()}function b(a){return parseInt(a,10)}function g(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()}function c(a){if(!a)return;if(a.constructor==Date)return a;if(typeof a=="string"){var c=a.split("-");if(c.length==3)return new Date(b(c[0]),b(c[1])-1,b(c[2]));if(!/^-?\d+$/.test(a))return;a=b(a)}var d=new Date;d.setDate(d.getDate()+a);return d}function l(m,l){var h=this,A=new Date,e=l.css,x=d[l.lang],n=a("#"+e.root),F=n.find("#"+e.title),D,C,B,v,u,w,p=m.attr("data-value")||l.value||m.val(),o=m.attr("min")||l.min,q=m.attr("max")||l.max,r;if(o===0)o="0";p=c(p)||A;o=c(o||l.yearRange[0]*365);q=c(q||l.yearRange[1]*365);if(!x)throw"Dateinput: invalid language: "+l.lang;if(m.attr("type")=="date"){var G=a("<input/>");a.each("class,disabled,id,maxlength,name,readonly,required,size,style,tabindex,title,value".split(","),function(b,a){G.attr(a,m.attr(a))});m.replaceWith(G);m=G}m.addClass(e.input);var z=m.add(h);if(!n.length){n=a("<div><div><a/><div/><a/></div><div><div/><div/></div></div>").hide().css({position:"absolute"}).attr("id",e.root);n.children().eq(0).attr("id",e.head).end().eq(1).attr("id",e.body).children().eq(0).attr("id",e.days).end().eq(1).attr("id",e.weeks).end().end().end().find("a").eq(0).attr("id",e.prev).end().eq(1).attr("id",e.next);F=n.find("#"+e.head).find("div").attr("id",e.title);if(l.selectors){var s=a("<select/>").attr("id",e.month),t=a("<select/>").attr("id",e.year);F.html(s.add(t))}for(var J=n.find("#"+e.days),H=0;H<7;H++)J.append(a("<span/>").text(x.shortDays[(H+l.firstDay)%7]));a("body").append(n)}if(l.trigger)D=a("<a/>").attr("href","#").addClass(e.trigger).click(function(a){h.show();return a.preventDefault()}).insertAfter(m);var y=n.find("#"+e.weeks);t=n.find("#"+e.year);s=n.find("#"+e.month);function E(b,d,c){p=b;v=b.getFullYear();u=b.getMonth();w=b.getDate();c=c||a.Event("api");c.type="change";z.trigger(c,[b]);if(c.isDefaultPrevented())return;m.val(i(b,d.format,d.lang));m.data("date",b);h.hide(c)}function I(b){b.type="onShow";z.trigger(b);a(document).bind("keydown.d",function(d){if(d.ctrlKey)return true;var b=d.keyCode;if(b==8){m.val("");return h.hide(d)}if(b==27)return h.hide(d);if(a(k).index(b)>=0){if(!r){h.show(d);return d.preventDefault()}var g=a("#"+e.weeks+" a"),f=a("."+e.focus),c=g.index(f);f.removeClass(e.focus);if(b==74||b==40)c+=7;else if(b==75||b==38)c-=7;else if(b==76||b==39)c+=1;else if(b==72||b==37)c-=1;if(c>41){h.addMonth();f=a("#"+e.weeks+" a:eq("+(c-42)+")")}else if(c<0){h.addMonth(-1);f=a("#"+e.weeks+" a:eq("+(c+42)+")")}else f=g.eq(c);f.addClass(e.focus);return d.preventDefault()}if(b==34)return h.addMonth();if(b==33)return h.addMonth(-1);if(b==36)return h.today();if(b==13)!a(d.target).is("select")&&a("."+e.focus).click();return a([16,17,18,9]).index(b)>=0});a(document).bind("click.d",function(c){var b=c.target;!a(b).parents("#"+e.root).length&&b!=m[0]&&(!D||b!=D[0])&&h.hide(c)})}a.extend(h,{show:function(b){if(m.attr("readonly")||m.attr("disabled")||r)return;b=b||a.Event();b.type="onBeforeShow";z.trigger(b);if(b.isDefaultPrevented())return;a.each(f,function(){this.hide()});r=true;s.unbind("change").change(function(){h.setValue(t.val(),a(this).val())});t.unbind("change").change(function(){h.setValue(a(this).val(),s.val())});C=n.find("#"+e.prev).unbind("click").click(function(){!C.hasClass(e.disabled)&&h.addMonth(-1);return false});B=n.find("#"+e.next).unbind("click").click(function(){!B.hasClass(e.disabled)&&h.addMonth();return false});h.setValue(p);var c=m.offset();if(/iPad/i.test(navigator.userAgent))c.top-=a(window).scrollTop();n.css({top:c.top+m.outerHeight({margins:true})+l.offset[0],left:c.left+l.offset[1]});if(l.speed)n.show(l.speed,function(){I(b)});else{n.show();I(b)}return h},setValue:function(f,c,H){var d=b(c)>=-1?new Date(b(f),b(c),b(H||1)):f||p;if(d<o)d=o;else if(d>q)d=q;f=d.getFullYear();c=d.getMonth();H=d.getDate();if(c==-1){c=11;f--}else if(c==12){c=0;f++}if(!r){E(d,l);return h}u=c;v=f;var J=new Date(f,c,1-l.firstDay),n=J.getDay(),G=j(f,c),I=j(f,c-1),z;if(l.selectors){s.empty();a.each(x.months,function(b,c){o<new Date(f,b+1,-1)&&q>new Date(f,b,0)&&s.append(a("<option/>").html(c).attr("value",b))});t.empty();for(var D=A.getFullYear(),w=D+l.yearRange[0];w<D+l.yearRange[1];w++)o<=new Date(w+1,-1,1)&&q>new Date(w,0,0)&&t.append(a("<option/>").text(w));s.val(c);t.val(f)}else F.html(x.months[c]+" "+f);y.empty();C.add(B).removeClass(e.disabled);for(var m=!n?-7:0,i,k;m<(!n?35:42);m++){i=a("<a/>");if(m%7===0){z=a("<div/>").addClass(e.week);y.append(z)}if(m<n){i.addClass(e.off);k=I-n+m+1;d=new Date(f,c-1,k)}else if(m>=n+G){i.addClass(e.off);k=m-G-n+1;d=new Date(f,c+1,k)}else{k=m-n+1;d=new Date(f,c,k);if(g(p,d))i.attr("id",e.current).addClass(e.focus);else g(A,d)&&i.attr("id",e.today)}o&&d<o&&i.add(C).addClass(e.disabled);q&&d>q&&i.add(B).addClass(e.disabled);i.attr("href","#"+k).text(k).data("date",d);z.append(i)}y.find("a").click(function(c){var b=a(this);if(!b.hasClass(e.disabled)){a("#"+e.current).removeAttr("id");b.attr("id",e.current);E(b.data("date"),l,c)}return false});e.sunday&&y.find(e.week).each(function(){var b=l.firstDay?7-l.firstDay:0;a(this).children().slice(b,b+1).addClass(e.sunday)});return h},setMin:function(b,a){o=c(b);a&&p<o&&h.setValue(o);return h},setMax:function(b,a){q=c(b);a&&p>q&&h.setValue(q);return h},today:function(){return h.setValue(A)},addDay:function(a){return this.setValue(v,u,w+(a||1))},addMonth:function(a){return this.setValue(v,u+(a||1),w)},addYear:function(a){return this.setValue(v+(a||1),u,w)},hide:function(b){if(r){b=a.Event();b.type="onHide";z.trigger(b);a(document).unbind("click.d").unbind("keydown.d");if(b.isDefaultPrevented())return;n.hide();r=false}return h},getConf:function(){return l},getInput:function(){return m},getCalendar:function(){return n},getValue:function(a){return a?i(p,a,l.lang):p},isOpen:function(){return r}});a.each(["onBeforeShow","onShow","change","onHide"],function(c,b){a.isFunction(l[b])&&a(h).bind(b,l[b]);h[b]=function(c){c&&a(h).bind(b,c);return h}});m.bind("focus click",h.show).keydown(function(b){var c=b.keyCode;if(!r&&a(k).index(c)>=0){h.show(b);return b.preventDefault()}return b.shiftKey||b.ctrlKey||b.altKey||c==9?true:b.preventDefault()});c(m.val())&&E(p,l)}a.expr[":"].date=function(c){var b=c.getAttribute("type");return b&&b=="date"||!!a(c).data("dateinput")};a.fn.dateinput=function(b){if(this.data("dateinput"))return this;b=a.extend(true,{},e.conf,b);a.each(b.css,function(a,c){if(!c&&a!="prefix")b.css[a]=(b.css.prefix||"")+(c||a)});var c;this.each(function(){var d=new l(a(this),b);f.push(d);var e=d.getInput().data("dateinput",d);c=c?c.add(e):e});return c?c:this}})(jQuery)