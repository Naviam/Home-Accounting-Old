(function(b){var d=b.tools.overlay,a=b(window);b.extend(d.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function c(a){var b=a.offset();return{top:b.top+a.height()/2,left:b.left+a.width()/2}}var f=function(h,o){var d=this.getOverlay(),e=this.getConf(),l=this.getTrigger(),p=this,m=d.outerWidth({margin:true}),f=d.data("img"),k=e.fixed?"fixed":"absolute";if(!f){var g=d.css("backgroundImage");if(!g)throw"background-image CSS property not set for overlay";g=g.slice(g.indexOf("(")+1,g.indexOf(")")).replace(/\"/g,"");d.css("backgroundImage","none");f=b('<img src="'+g+'"/>');f.css({border:0,display:"none"}).width(m);b("body").append(f);d.data("img",f)}var j=e.start.top||Math.round(a.height()/2),i=e.start.left||Math.round(a.width()/2);if(l){var n=c(l);j=n.top;i=n.left}if(e.fixed){j-=a.scrollTop();i-=a.scrollLeft()}else{h.top+=a.scrollTop();h.left+=a.scrollLeft()}f.css({position:"absolute",top:j,left:i,width:0,zIndex:e.zIndex}).show();h.position=k;d.css(h);f.animate({top:d.css("top"),left:d.css("left"),width:m},e.speed,function(){d.css("zIndex",e.zIndex+1).fadeIn(e.fadeInSpeed,function(){if(p.isOpened()&&!b(this).index(d))o.call();else d.hide()})}).css("position",k)},e=function(h){var i=this.getOverlay().hide(),d=this.getConf(),e=this.getTrigger(),g=i.data("img"),f={top:d.start.top,left:d.start.left,width:0};e&&b.extend(f,c(e));d.fixed&&g.css({position:"absolute"}).animate({top:"+="+a.scrollTop(),left:"+="+a.scrollLeft()},0);g.animate(f,d.closeSpeed,h)};d.addEffect("apple",f,e)})(jQuery)