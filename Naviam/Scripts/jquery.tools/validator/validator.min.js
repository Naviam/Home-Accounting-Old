(function(a){a.tools=a.tools||{version:"@VERSION"};var j=/\[type=([a-z]+)\]/,k=/^-?[0-9]*(\.[0-9]+)?$/,d=a.tools.dateinput,h=/^([a-z0-9_\.\-\+]+)@([\da-z\.\-]+)\.([a-z\.]{2,6})$/i,l=/^(https?:\/\/)?[\da-z\.\-]+\.[a-z\.]{2,6}[#&+_\?\/\w \.\-=]*$/i,b;b=a.tools.validator={conf:{grouped:false,effect:"default",errorClass:"invalid",inputEvent:null,errorInputEvent:"keyup",formEvent:"submit",lang:"en",message:"<div/>",messageAttr:"data-message",messageClass:"error",offset:[0,0],position:"center right",singleError:false,speed:"normal"},messages:{"*":{en:"Please correct this value"}},localize:function(d,c){a.each(c,function(a,c){b.messages[a]=b.messages[a]||{};b.messages[a][d]=c})},localizeFn:function(c,d){b.messages[c]=b.messages[c]||{};a.extend(b.messages[c],d)},fn:function(c,b,e){if(a.isFunction(b))e=b;else{if(typeof b=="string")b={en:b};this.messages[c.key||c]=b}var d=j.exec(c);if(d)c=i(d[1]);g.push([c,e])},addEffect:function(d,b,a){c[d]=[b,a]}};function e(b,f,e){var c=b.offset().top,d=b.offset().left,i=e.position.split(/,?\s+/),k=i[0],j=i[1];c-=f.outerHeight()-e.offset[0];d+=b.outerWidth()+e.offset[1];if(/iPad/i.test(navigator.userAgent))c-=a(window).scrollTop();var g=f.outerHeight()+b.outerHeight();if(k=="center")c+=g/2;if(k=="bottom")c+=g;var h=b.outerWidth();if(j=="center")d-=(h+f.outerWidth())/2;if(j=="left")d-=h;return{top:c,left:d}}function i(a){function b(){return this.getAttribute("type")==a}b.key="[type="+a+"]";return b}var g=[],c={"default":[function(c){var b=this.getConf();a.each(c,function(h,f){var d=f.input;d.addClass(b.errorClass);var c=d.data("msg.el");if(!c){c=a(b.message).addClass(b.messageClass).appendTo(document.body);d.data("msg.el",c)}c.css({visibility:"hidden"}).find("p").remove();a.each(f.messages,function(d,b){a("<p/>").html(b).appendTo(c)});c.outerWidth()==c.parent().width()&&c.add(c.find("p")).css({display:"inline"});var g=e(d,c,b);c.css({visibility:"visible",position:"absolute",top:g.top,left:g.left}).fadeIn(b.speed)})},function(b){var c=this.getConf();b.removeClass(c.errorClass).each(function(){var b=a(this).data("msg.el");b&&b.css({visibility:"hidden"})})}]};a.each("email,url,number".split(","),function(c,b){a.expr[":"][b]=function(a){return a.getAttribute("type")===b}});a.fn.oninvalid=function(a){return this[a?"bind":"trigger"]("OI",a)};b.fn(":email","Please enter a valid email address",function(b,a){return!a||h.test(a)});b.fn(":url","Please enter a valid URL",function(b,a){return!a||l.test(a)});b.fn(":number","Please enter a numeric value.",function(b,a){return k.test(a)});b.fn("[max]","Please enter a value smaller than $1",function(b,c){if(c===""||d&&b.is(":date"))return true;var a=b.attr("max");return parseFloat(c)<=parseFloat(a)?true:[a]});b.fn("[min]","Please enter a value larger than $1",function(b,c){if(c===""||d&&b.is(":date"))return true;var a=b.attr("min");return parseFloat(c)>=parseFloat(a)?true:[a]});b.fn("[required]","Please complete this mandatory field.",function(a,b){return a.is(":checkbox")?a.is(":checked"):!!b});b.fn("[pattern]",function(a){var b=new RegExp("^"+a.attr("pattern")+"$");return b.test(a.val())});function f(i,j,f){var h=this,k=j.add(h);i=i.not(":button, :image, :reset, :submit");function l(h,e,d){if(!f.grouped&&h.length)return;var c;if(d===false||a.isArray(d)){c=b.messages[e.key||e]||b.messages["*"];c=c[f.lang]||b.messages["*"].en;var g=c.match(/\$\d/g);g&&a.isArray(d)&&a.each(g,function(a){c=c.replace(this,d[a])})}else c=d[f.lang]||d;h.push(c)}a.extend(h,{getConf:function(){return f},getForm:function(){return j},getInputs:function(){return i},reflow:function(){i.each(function(){var c=a(this),b=c.data("msg.el");if(b){var d=e(c,b,f);b.css({top:d.top,left:d.left})}});return h},invalidate:function(d,b){if(!b){var e=[];a.each(d,function(c,b){var a=i.filter("[name='"+c+"']");if(a.length){a.trigger("OI",[b]);e.push({input:a,messages:[b]})}});d=e;b=a.Event()}b.type="onFail";k.trigger(b,[d]);!b.isDefaultPrevented()&&c[f.effect][0].call(h,d,b);return h},reset:function(b){b=b||i;b.removeClass(f.errorClass).each(function(){var b=a(this).data("msg.el");if(b){b.remove();a(this).data("msg.el",null)}}).unbind(f.errorInputEvent||"");return h},destroy:function(){j.unbind(f.formEvent+".V").unbind("reset.V");i.unbind(f.inputEvent+".V").unbind("change.V");return h.reset()},checkValidity:function(e,b){e=e||i;e=e.not(":disabled");if(!e.length)return true;b=b||a.Event();b.type="onBeforeValidate";k.trigger(b,[e]);if(b.isDefaultPrevented())return b.result;var j=[];e.not(":radio:not(:checked)").each(function(){var e=[],c=a(this).data("messages",e),i=d&&c.is(":date")?"onHide.v":f.errorInputEvent+".v";c.unbind(i);a.each(g,function(){var i=this,a=i[0];if(c.filter(a).length){var d=i[1].call(h,c,c.val());if(d!==true){b.type="onBeforeFail";k.trigger(b,[c,a]);if(b.isDefaultPrevented())return false;var g=c.attr(f.messageAttr);if(g){e=[g];return false}else l(e,a,d)}}});if(e.length){j.push({input:c,messages:e});c.trigger("OI",[e]);f.errorInputEvent&&c.bind(i,function(a){h.checkValidity(c,a)})}if(f.singleError&&j.length)return false});var m=c[f.effect];if(!m)throw'Validator: cannot find effect "'+f.effect+'"';if(j.length){h.invalidate(j,b);return false}else{m[1].call(h,e,b);b.type="onSuccess";k.trigger(b,[e]);e.unbind(f.errorInputEvent+".v")}return true}});a.each("onBeforeValidate,onBeforeFail,onFail,onSuccess".split(","),function(c,b){a.isFunction(f[b])&&a(h).bind(b,f[b]);h[b]=function(c){c&&a(h).bind(b,c);return h}});f.formEvent&&j.bind(f.formEvent+".V",function(a){if(!h.checkValidity(null,a))return a.preventDefault()});j.bind("reset.V",function(){h.reset()});i[0]&&i[0].validity&&i.each(function(){this.oninvalid=function(){return false}});if(j[0])j[0].checkValidity=h.checkValidity;f.inputEvent&&i.bind(f.inputEvent+".V",function(b){h.checkValidity(a(this),b)});i.filter(":checkbox, select").filter("[required]").bind("change.V",function(d){var b=a(this);(this.checked||b.is("select")&&a(this).val())&&c[f.effect][1].call(h,b,d)});var m=i.filter(":radio").change(function(a){h.checkValidity(m,a)});a(window).resize(function(){h.reflow()})}a.fn.validator=function(d){var c=this.data("validator");if(c){c.destroy();this.removeData("validator")}d=a.extend(true,{},b.conf,d);if(this.is("form"))return this.each(function(){var b=a(this);c=new f(b.find(":input"),b,d);b.data("validator",c)});else{c=new f(this,this.eq(0).closest("form"),d);return this.data("validator",c)}}})(jQuery)