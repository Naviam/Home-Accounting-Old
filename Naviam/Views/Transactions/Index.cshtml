@{
    ViewBag.Title = "Transactions";
    Layout = "~/Views/Shared/LayoutMember.cshtml";
}
@*intellisense support*@
@if (false)
{ 
    <script type="text/javascript" src="~/Scripts/jquery-1.6.2.js"></script> 
    <script type="text/javascript" src="~/Scripts/knockout-1.2.1.js"></script> 
    <script type="text/javascript" src="~/Scripts/knockout.mapping.js"></script> 
}

<script type='text/javascript'>

    //JSON.stringify
    var transModel = {
        paging: { Page: 1 }
        };
        $(document).ready(function () {
            $.postErr('@Url.Action("GetTransactions", "Transactions")', transModel.paging, function (res) {
                transModel = ko.mapping.fromJS(res);
                transModel.paging.Page.subscribe(function (newValue) {
                    transModel.ReloadPage();
                });
                transModel.selectedRow = ko.observable(-1);
                transModel.ReloadPage = function () {
                    $.postErr('@Url.Action("GetTransactions", "Transactions")', transModel.paging, function (res) {
                        ko.mapping.updateFromJS(transModel, res);
                        transModel.selectedRow(-1);
                    });
                }
                transModel.GoToEdit = function (item) {
                    transModel.selectedRow(item.Id());
//                    item.Description.subscribe(function (newValue) {
//                        alert(newValue);
//                    });
                }
                transModel.ShowEditArea = function (btn) {
                    var editArea = $(btn).parent().find('.edit_area');
                    //load data into form
                    editArea.slideDown();
                }
                ko.applyBindings(transModel, $("#transGrid")[0]);
            });
        });
</script>

<a href="#" onclick='return transModel.ReloadPage();'>Refresh</a>

<script type="text/html" id="transRowTemplate">
    <tr data-bind="click: function() { transModel.GoToEdit($data); }, css: {selected: transModel.selectedRow() == Id()}">
        <td><span data-bind="visible: transModel.selectedRow() != Id(), text: Description"></span><input data-bind="visible: transModel.selectedRow() == Id(), value: Description" /></td>
        <td><span data-bind="visible: transModel.selectedRow() != Id(), text: Category"></span><input data-bind="visible: transModel.selectedRow() == Id(), value: Category" /></td>
        <td><span data-bind="visible: transModel.selectedRow() != Id(), text: Amount"></span><input data-bind="visible: transModel.selectedRow() == Id(), value: Amount" /></td>
    </tr>
//    <div data-bind="visible: transModel.selectedRow() == Id()">
//        <a href="#" onclick='return transModel.ShowEditArea(this);'>Edit</a>
//        <div class='edit_area hidden' data-bind="visible: transModel.selectedRow() == Id()">
//            tstst
//        </div>
//    </div>
</script>
<script type="text/html" id="transPagingTemplate">
    <span>Page:</span>
    {{each(i) ko.utils.range(1, paging.PagesCount)}}
        <a href="#" data-bind="click: function() { paging.Page(i+1) }, css: { selected: i+1 == paging.Page() }">
            ${ i + 1 }
        </a>
    {{/each}}
</script>

<div id="transGrid">
    <table class='trans_grid'>
        <thead>
            <tr>
                <th>Description</th>
                <th>Category</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody data-bind='template: { name: "transRowTemplate", foreach: items }'></tbody>
    </table>
    <div data-bind='template: "transPagingTemplate"' class='paging'></div>
</div> 




